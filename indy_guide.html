<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NICAR Indy Restaurant Guide</title>
<meta name="description" content="Curated restaurant, bar, and coffee guide for NICAR 2026 in Indianapolis ‚Äî with an interactive map, filters, and local tips.">
<meta property="og:title" content="NICAR 2026 Indy Guide">
<meta property="og:description" content="Curated restaurant, bar, and coffee guide for NICAR 2026 in Indianapolis ‚Äî with an interactive map, filters, and local tips.">
<meta property="og:type" content="website">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f4f1ec;
    --surface: #eae6df;
    --surface-hover: #e0dbd3;
    --border: #d1cbc2;
    --text: #2c2a26;
    --text-muted: #7a756b;
    --accent: #b8792e;
    --green: #2271b2;
    --red: #d55e00;
    --blue: #009e73;
    --purple: #994f88;
    --tag-bg: rgba(184, 121, 46, 0.1);
    --tag-border: rgba(184, 121, 46, 0.3);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { height: 100%; }

  body {
    font-family: 'IBM Plex Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    -webkit-text-size-adjust: 100%;
    touch-action: manipulation;
  }

  /* Nav */
  .nav {
    display: flex;
    gap: 4px;
  }
  .nav a {
    padding: 6px 16px;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-muted);
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .nav a:hover {
    color: var(--text);
    background: var(--surface-hover);
  }
  .nav a.active {
    color: var(--accent);
    background: var(--tag-bg);
  }

  /* Pages */
  .page { display: none; }
  .page.active {
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }
  .page.active .app {
    flex: 1;
    min-height: 0;
  }
  .page-empty {
    display: none;
    flex: 1;
    overflow: hidden;
  }
  .page-empty.active { display: flex; }

  /* When showing content pages, unlock body scroll */
  body.content-mode {
    height: auto;
    overflow: auto;
  }
  body.content-mode .page-empty.active {
    display: block;
    overflow: visible;
  }

  /* Header */
  .header {
    padding: 1rem 2rem;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, #ece8e1 0%, var(--bg) 100%);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }
  .header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.6rem;
    color: var(--accent);
    letter-spacing: -0.02em;
  }
  .header .subtitle {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
  }
  .header p {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-top: 0.15rem;
  }
  .header p a {
    color: var(--accent);
    text-decoration: none;
  }
  .header p a:hover {
    text-decoration: underline;
  }

  /* Layout */
  .app {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  /* Map Panel */
  .map-panel {
    position: relative;
    border-bottom: 1px solid var(--border);
    height: 45vh;
    min-height: 280px;
    flex-shrink: 0;
  }
  #map {
    width: 100%;
    height: 100%;
  }
  .leaflet-popup-content-wrapper {
    background: var(--surface) !important;
    color: var(--text) !important;
    border-radius: 10px !important;
    border: 1px solid var(--border) !important;
    box-shadow: 0 12px 40px rgba(0,0,0,0.15) !important;
  }
  .leaflet-popup-tip {
    background: var(--surface) !important;
    border: 1px solid var(--border) !important;
    border-top: none !important;
    border-left: none !important;
  }
  .leaflet-popup-content {
    margin: 14px 16px !important;
    font-family: 'IBM Plex Sans', sans-serif !important;
    font-size: 13px !important;
    line-height: 1.5 !important;
  }
  .popup-name {
    font-family: 'DM Serif Display', serif;
    font-size: 1.05rem;
    color: var(--accent);
    margin-bottom: 4px;
  }
  .popup-cuisine {
    color: var(--text-muted);
    font-size: 0.8rem;
    font-family: 'IBM Plex Mono', monospace;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 6px;
  }
  .popup-price {
    font-weight: 600;
    margin-bottom: 4px;
  }
  .popup-hours {
    display: inline-block;
    background: rgba(213, 94, 0, 0.08);
    border: 1px solid rgba(213, 94, 0, 0.2);
    padding: 1px 6px;
    border-radius: 99px;
    font-size: 0.68rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--red);
    margin-bottom: 4px;
  }
  .popup-desc {
    color: var(--text-muted);
    font-size: 0.82rem;
    line-height: 1.45;
  }
  .leaflet-container {
    background: #f4f1ec !important;
  }

  /* Table Panel */
  .table-panel {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-height: 0;
    flex: 1;
  }

  /* Filters */
  .filters {
    padding: 0.75rem 1.25rem;
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    flex-shrink: 0;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    align-items: center;
  }
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .filter-group label {
    font-size: 0.65rem;
    font-family: 'IBM Plex Mono', monospace;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
  }
  .filter-group select, .filter-group input {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 5px 10px;
    border-radius: 6px;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.85rem;
    outline: none;
    min-width: 120px;
  }
  .filter-group select:focus, .filter-group input:focus {
    border-color: var(--accent);
  }
  .filter-group input::placeholder {
    color: var(--text-muted);
  }
  .reset-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-muted);
    padding: 6px 14px;
    border-radius: 6px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.75rem;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    align-self: flex-end;
    transition: all 0.15s;
  }
  .reset-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }
  .result-count {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.75rem;
    color: var(--text-muted);
    align-self: flex-end;
    margin-left: auto;
  }

  .directions-link {
    display: inline-block;
    font-size: 0.68rem;
    color: var(--accent);
    text-decoration: none;
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 2px;
  }
  .directions-link:hover {
    text-decoration: underline;
  }

  /* Table */
  .table-scroll {
    flex: 1;
    overflow-y: auto;
    overflow-x: auto;
    min-height: 0;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }
  thead {
    position: sticky;
    top: 0;
    z-index: 5;
  }
  th {
    background: var(--surface);
    text-align: left;
    padding: 6px 8px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
    user-select: none;
    white-space: nowrap;
  }
  th[data-sort] {
    cursor: pointer;
  }
  th[data-sort]:hover {
    color: var(--accent);
  }
  th .sort-arrow {
    margin-left: 4px;
    opacity: 0.4;
  }
  th.sorted .sort-arrow {
    opacity: 1;
    color: var(--accent);
  }
  td {
    padding: 5px 8px;
    border-bottom: 1px solid var(--border);
    font-size: 0.78rem;
    vertical-align: top;
    overflow: hidden;
  }
  tr {
    transition: background 0.1s;
    cursor: pointer;
  }
  tr:hover {
    background: var(--surface-hover);
  }
  tr.highlighted {
    background: rgba(184, 121, 46, 0.1);
  }
  .name-cell {
    font-weight: 600;
    color: var(--text);
    min-width: 100px;
    font-size: 0.8rem;
  }
  .name-cell .address {
    font-weight: 400;
    font-size: 0.68rem;
    color: var(--text-muted);
    margin-top: 1px;
  }
  .cuisine-tag {
    display: inline-block;
    background: var(--tag-bg);
    border: 1px solid var(--tag-border);
    padding: 1px 6px;
    border-radius: 99px;
    font-size: 0.68rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--accent);
    white-space: nowrap;
  }
  .cuisine-cell {
    font-size: 0.75rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--text-muted);
  }
  .price-cell {
    font-weight: 600;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.78rem;
  }
  .price-1 { color: var(--green); }
  .price-2 { color: var(--blue); }
  .price-3 { color: var(--purple); }
  .price-4 { color: var(--red); }

  .distance-cell {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-muted);
    white-space: nowrap;
  }
  .type-cell {
    font-size: 0.72rem;
    color: var(--text-muted);
  }
  .hours-cell {
    font-size: 0.68rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--red);
    max-width: 160px;
    line-height: 1.35;
    white-space: normal;
  }
  .notes-cell {
    font-size: 0.75rem;
    color: var(--text-muted);
    line-height: 1.35;
  }
  .hours-note {
    display: inline-block;
    background: rgba(213, 94, 0, 0.08);
    border: 1px solid rgba(213, 94, 0, 0.2);
    padding: 1px 7px;
    border-radius: 99px;
    font-size: 0.68rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--red);
    margin-bottom: 4px;
  }
  .diet-badge {
    display: inline-block;
    background: rgba(34, 113, 178, 0.1);
    border: 1px solid rgba(34, 113, 178, 0.25);
    padding: 1px 6px;
    border-radius: 99px;
    font-size: 0.68rem;
    color: var(--green);
    margin-top: 3px;
  }
  .group-badge {
    display: inline-block;
    background: rgba(184, 121, 46, 0.1);
    border: 1px solid rgba(184, 121, 46, 0.25);
    padding: 1px 6px;
    border-radius: 99px;
    font-size: 0.68rem;
    color: var(--accent);
    margin-top: 3px;
  }

  /* Custom marker */
  .custom-marker {
    display: block;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--accent);
    border: 2.5px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    transition: transform 0.15s;
  }
  .custom-marker:hover {
    transform: scale(1.2);
  }
  .custom-marker.highlighted {
    background: var(--red);
    transform: scale(1.3);
    z-index: 999 !important;
  }

  /* Legend */
  .legend {
    position: absolute;
    bottom: 24px;
    left: 16px;
    z-index: 800;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 0.75rem;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  }
  .legend-title {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 6px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 3px;
    color: var(--text-muted);
  }
  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* Locate button */
  .locate-btn, .reset-map-btn {
    position: absolute;
    z-index: 800;
    width: 38px;
    height: 38px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: all 0.15s;
  }
  .locate-btn { top: 14px; right: 14px; }
  .reset-map-btn { top: 60px; right: 14px; }
  .locate-btn:hover, .reset-map-btn:hover {
    border-color: var(--accent);
    background: var(--surface-hover);
  }
  .reset-map-btn:hover span {
    color: var(--accent) !important;
  }
  .locate-btn.active {
    border-color: var(--blue);
  }
  .locate-btn svg, .reset-map-btn svg {
    width: 18px;
    height: 18px;
    stroke: var(--text-muted);
    fill: none;
    stroke-width: 2;
    transition: stroke 0.15s;
  }
  .locate-btn:hover svg, .reset-map-btn:hover svg {
    stroke: var(--accent);
  }
  .locate-btn.active svg {
    stroke: var(--blue);
    fill: rgba(0, 158, 115, 0.15);
  }
  .locate-btn.loading {
    animation: pulse-border 1s ease infinite;
  }
  @keyframes pulse-border {
    0%, 100% { border-color: var(--border); }
    50% { border-color: var(--blue); }
  }

  /* User location dot */
  .user-location-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--blue);
    border: 3px solid #fff;
    box-shadow: 0 0 0 4px rgba(0, 158, 115, 0.25), 0 2px 6px rgba(0,0,0,0.2);
    animation: pulse-dot 2s ease-in-out infinite;
  }
  @keyframes pulse-dot {
    0%, 100% { box-shadow: 0 0 0 4px rgba(0, 158, 115, 0.25), 0 2px 6px rgba(0,0,0,0.2); }
    50% { box-shadow: 0 0 0 10px rgba(0, 158, 115, 0.08), 0 2px 6px rgba(0,0,0,0.2); }
  }

  @media (max-width: 900px) {
    body {
      height: auto;
      overflow: auto;
    }

    /* Header & Nav */
    .header {
      padding: 0.75rem 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .header .subtitle {
      font-size: 0.65rem;
    }
    .header h1 {
      font-size: 1.35rem;
    }
    .header p {
      font-size: 0.75rem;
    }
    .nav {
      gap: 2px;
    }
    .nav a {
      padding: 8px 14px;
      font-size: 0.85rem;
      border-radius: 8px;
      min-height: 44px;
      display: flex;
      align-items: center;
    }

    /* Page & App layout */
    .page.active {
      overflow: visible;
    }
    .app {
      height: auto;
      min-height: 0;
      overflow: visible;
    }
    .map-panel {
      height: 50vh;
      min-height: 250px;
    }

    /* Filters ‚Äî 2-col grid */
    .filters {
      padding: 0.85rem 1rem;
      gap: 0.6rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: end;
    }
    .filter-group label {
      font-size: 0.75rem;
    }
    .filter-group select, .filter-group input {
      font-size: 16px; /* prevents iOS zoom */
      padding: 12px 14px;
      min-width: 0;
      width: 100%;
      border-radius: 8px;
      min-height: 44px;
    }
    .filter-group:nth-child(6) {
      grid-column: 1 / -1; /* search spans full width */
    }
    .reset-btn {
      padding: 12px 20px;
      font-size: 0.82rem;
      min-height: 44px;
      border-radius: 8px;
    }
    .result-count {
      font-size: 0.82rem;
      margin-left: 0;
      padding: 4px 0;
    }

    /* Map controls ‚Äî smaller on mobile */
    .locate-btn, .reset-map-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
    }
    .locate-btn { top: 8px; right: 8px; }
    .reset-map-btn { top: 50px; right: 8px; }
    .locate-btn svg, .reset-map-btn svg {
      width: 16px;
      height: 16px;
    }
    .reset-map-btn span {
      font-size: 18px !important;
    }

    /* Legend ‚Äî collapsed by default on mobile */
    .legend {
      bottom: 6px;
      left: 6px;
      padding: 4px 8px;
      font-size: 0.55rem;
      border-radius: 5px;
      max-width: 90px;
      cursor: pointer;
    }
    .legend-title {
      font-size: 0.52rem;
      pointer-events: none;
    }
    .legend-title::after {
      content: ' ‚ñ∏';
      font-size: 0.5rem;
    }
    .legend.expanded .legend-title::after {
      content: ' ‚ñæ';
    }
    .legend-item {
      display: none;
      margin-bottom: 1px;
    }
    .legend.expanded .legend-item {
      display: flex;
    }
    .legend.expanded {
      max-width: none;
    }
    .legend-dot {
      width: 8px;
      height: 8px;
    }

    /* Smaller popups on mobile */
    .leaflet-popup-content {
      margin: 8px 10px !important;
      font-size: 11px !important;
    }
    .leaflet-popup-content-wrapper {
      max-width: 200px !important;
    }
    .popup-name { font-size: 0.85rem; }
    .popup-cuisine { font-size: 0.65rem; margin-bottom: 3px; }
    .popup-price { font-size: 0.78rem; margin-bottom: 2px; }
    .popup-hours { font-size: 0.6rem; padding: 0px 5px; margin-bottom: 2px; }
    .popup-desc { font-size: 0.7rem; line-height: 1.35; }

    /* Directions link in popup */
    .leaflet-popup-content a {
      font-size: 0.75rem !important;
      padding: 3px 0 1px;
      display: inline-block;
    }

    /* Hide table on mobile, cards container handles display */
    .table-scroll {
      display: none;
    }
  }

  /* Mobile cards container */
  .mobile-cards {
    display: none;
  }
  @media (max-width: 900px) {
    .mobile-cards {
      display: block;
      padding: 0.5rem 1rem 2rem;
      overflow-y: auto;
    }
  }

  /* Card layout for mobile */
  .mobile-card {
    display: none;
  }
  @media (max-width: 900px) {
    .mobile-card {
      display: block;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 18px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background 0.1s;
      -webkit-tap-highlight-color: rgba(0,0,0,0.05);
    }
    .mobile-card:active {
      background: var(--surface-hover);
    }
    .mobile-card.highlighted {
      border-color: var(--accent);
      background: rgba(184, 121, 46, 0.06);
    }
    .mobile-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 6px;
    }
    .mobile-card-name {
      font-family: 'DM Serif Display', serif;
      font-size: 1.2rem;
      color: var(--text);
      line-height: 1.25;
    }
    .mobile-card-price {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 600;
      font-size: 1rem;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .mobile-card-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }
    .mobile-card-meta .cuisine-tag {
      font-size: 0.82rem;
      padding: 4px 12px;
    }
    .mobile-card-distance {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.88rem;
      color: var(--text-muted);
    }
    .mobile-card-meal {
      font-size: 0.88rem;
      color: var(--text-muted);
    }
    .mobile-card-notes {
      font-size: 0.95rem;
      line-height: 1.55;
      color: var(--text-muted);
    }
    .mobile-card-notes .hours-note {
      font-size: 0.75rem;
      padding: 2px 8px;
      margin-bottom: 4px;
    }
    .mobile-card-notes .diet-badge {
      font-size: 0.8rem;
      padding: 3px 10px;
      margin-top: 8px;
    }
    .mobile-card-notes .group-badge {
      font-size: 0.8rem;
      padding: 3px 10px;
      margin-top: 4px;
    }
    .mobile-card-address {
      font-size: 0.88rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .mobile-card-address .directions-link {
      font-size: 0.88rem;
      padding: 4px 0;
    }
  }

  /* Content pages (Logistics / Things to Do) */
  .content-page {
    flex: 1;
    padding: 2rem;
    max-width: 860px;
    margin: 0 auto;
    width: 100%;
  }
  .content-page h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.6rem;
    color: var(--accent);
    margin-bottom: 0.25rem;
    margin-top: 2rem;
  }
  .content-page h2:first-child { margin-top: 0; }
  .content-page h3 {
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.5rem;
    margin-top: 1.25rem;
  }
  .content-page h2 + h3,
  .content-page h2 + p + h3 {
    margin-top: 0.75rem;
  }
  .content-page p {
    font-size: 1rem;
    line-height: 1.65;
    color: var(--text);
    margin-bottom: 0.5rem;
  }
  .content-page a {
    color: var(--accent);
    text-decoration: none;
  }
  .content-page a:hover { text-decoration: underline; }
  .content-page ul {
    list-style: none;
    padding: 0;
    margin-bottom: 0.5rem;
  }
  /* Places to Wander plain list */
  .content-page ul:not(.activity-list) li {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--text);
    padding: 0.35rem 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    align-items: baseline;
  }
  .content-page ul:not(.activity-list) li strong { color: var(--text); font-weight: 600; }
  .content-page ul:not(.activity-list) li .note {
    font-size: 1rem;
    color: var(--text-muted);
    flex-basis: 100%;
    line-height: 1.6;
  }
  /* Activity list */
  .activity-list li {
    padding: 0.3rem 0;
  }
  .activity-main {
    font-size: 1rem;
    line-height: 1.6;
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    align-items: center;
  }
  .activity-main strong { font-weight: 600; color: var(--text); }
  .activity-note {
    font-size: 1rem;
    color: var(--text-muted);
    line-height: 1.6;
    margin-top: 1px;
  }
  .content-page .meta {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.8rem;
    color: var(--text-muted);
  }
  .table-note {
    font-size: 0.8rem !important;
    color: var(--text-muted);
    margin-top: -0.5rem;
    margin-bottom: 1rem;
  }
  .transport-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
    font-size: 1rem;
  }
  .transport-table th {
    background: var(--surface);
    text-align: left;
    padding: 8px 12px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
  }
  .transport-table td {
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
    line-height: 1.6;
  }
  .transport-table tr:last-child td { border-bottom: none; }
  .cost-badge {
    display: inline-block;
    background: var(--tag-bg);
    border: 1px solid var(--tag-border);
    border-radius: 99px;
    padding: 1px 8px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.7rem;
    color: var(--accent);
    white-space: nowrap;
  }
  .date-badge {
    display: inline-block;
    background: rgba(0,158,115,0.08);
    border: 1px solid rgba(0,158,115,0.25);
    border-radius: 99px;
    padding: 1px 8px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.7rem;
    color: var(--blue);
    white-space: nowrap;
  }
  @media (max-width: 900px) {
    .content-page { padding: 1.25rem 1rem; }
    .content-page h2 { font-size: 1.3rem; }
    .table-wrap { margin-bottom: 0.5rem; }
    /* Stack all transport tables as cards on mobile */
    .transport-table,
    .transport-table tbody {
      display: block;
      width: 100%;
    }
    .transport-table { font-size: 0.88rem; }
    .transport-table thead { display: none; }
    .transport-table tbody tr {
      display: block;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 10px;
      padding: 10px 12px;
      background: var(--surface);
    }
    .transport-table tbody tr:last-child { border-bottom: 1px solid var(--border); }
    .transport-table td {
      display: block;
      width: 100%;
      padding: 3px 0;
      border-bottom: none;
      font-size: 0.88rem;
      line-height: 1.5;
    }
    .transport-table td:first-child {
      font-size: 0.95rem;
      font-weight: 600;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: 1px solid var(--border);
    }
    .transport-table td[data-label]::before {
      content: attr(data-label) ": ";
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.72rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
  }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>NICAR 2026 Indy Guide</h1>
    <p>Curated by local organizing committee, with restaurant recs by IndyStar dining and drinks reporter <a href="https://www.indystar.com/staff/8379975001/bradley-hohulin/">Bradley Hohulin</a>. Web app built by Julie Lee with Claude.</p>
  </div>
  <nav class="nav" role="tablist" aria-label="Page navigation">
    <a href="#" class="active" data-page="food" role="tab" aria-selected="true" aria-controls="page-food" id="tab-food">Food</a>
    <a href="#" data-page="logistics" role="tab" aria-selected="false" aria-controls="page-logistics" id="tab-logistics">Logistics</a>
    <a href="#" data-page="things-to-do" role="tab" aria-selected="false" aria-controls="page-things-to-do" id="tab-things-to-do">Things to Do</a>
  </nav>
</div>

<div class="page active" id="page-food" role="tabpanel" aria-labelledby="tab-food">
<div class="app">
  <div class="map-panel">
    <div id="map" role="application" aria-label="Interactive restaurant map of Indianapolis"></div>
    <button class="locate-btn" id="locate-btn" title="Show my location" aria-label="Show my location">
      <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
      </svg>
    </button>
    <button class="reset-map-btn" id="reset-map-btn" title="Reset map view" aria-label="Reset map view">
      <span style="font-size:18px;color:var(--text-muted);line-height:1;">‚Ü∫</span>
    </button>
    <div class="legend">
      <div class="legend-title">Legend</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--green)"></div> $</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--blue)"></div> $$</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--purple)"></div> $$$</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--red)"></div> $$$$</div>
      <div class="legend-item" style="margin-top:6px;padding-top:6px;border-top:1px solid var(--border)"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" style="flex-shrink:0"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26" fill="#b8792e" stroke="#b8792e" stroke-width="1" stroke-linejoin="round"/></svg> JW Marriott</div>
    </div>
  </div>
  <div class="table-panel">
    <div class="filters">
      <div class="filter-group">
        <label>Max Price</label>
        <select id="filter-price" aria-label="Filter by maximum price">
          <option value="">All</option>
          <option value="1">$</option>
          <option value="2">$$</option>
          <option value="3">$$$</option>
          <option value="4">$$$$</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Max Distance (walk or drive)</label>
        <select id="filter-distance" aria-label="Filter by maximum distance">
          <option value="">Any</option>
          <option value="5">‚â§ 5 min</option>
          <option value="10">‚â§ 10 min</option>
          <option value="15">‚â§ 15 min</option>
          <option value="20">‚â§ 20 min</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Cuisine</label>
        <select id="filter-cuisine" aria-label="Filter by cuisine type">
          <option value="">All</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Type</label>
        <select id="filter-meal" aria-label="Filter by meal type">
          <option value="">All</option>
          <option value="Breakfast/Brunch">Breakfast/Brunch</option>
          <option value="Lunch">Lunch</option>
          <option value="Dinner">Dinner</option>
          <option value="Late Night">Late Night</option>
          <option value="Coffee">Coffee</option>
          <option value="Bars">Bars</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Features</label>
        <select id="filter-dietary" aria-label="Filter by features">
          <option value="">All</option>
          <option value="dietary">Veg/Vegan/GF friendly</option>
          <option value="groups">Good for groups</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Search</label>
        <input type="text" id="filter-search" placeholder="Name, address, or note‚Ä¶" aria-label="Search restaurants">
      </div>
      <button class="reset-btn" onclick="resetFilters()">Reset</button>
      <div class="result-count" id="result-count" aria-live="polite"></div>
    </div>
    <div class="table-scroll">
      <table>
        <colgroup>
          <col style="width:15%"><!-- Name -->
          <col style="width:11%"><!-- Cuisine -->
          <col style="width:7%"><!-- Price -->
          <col style="width:10%"><!-- Distance -->
          <col style="width:12%"><!-- Type -->
          <col style="width:16%"><!-- Hours -->
          <col style="width:29%"><!-- Notes -->
        </colgroup>
        <thead>
          <tr>
            <th data-sort="name">Name <span class="sort-arrow">‚Üï</span></th>
            <th data-sort="cuisine">Cuisine <span class="sort-arrow">‚Üï</span></th>
            <th data-sort="price">Price <span class="sort-arrow">‚Üï</span></th>
            <th data-sort="distance">Dist. <span class="sort-arrow">‚Üï</span></th>
            <th data-sort="meal">Type <span class="sort-arrow">‚Üï</span></th>
            <th>Hours</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
    <div class="mobile-cards" id="mobile-cards"></div>
  </div>
</div>
</div>

<div class="page-empty" id="page-logistics" role="tabpanel" aria-labelledby="tab-logistics">
  <div class="content-page">
    <h2>Getting to/from the Airport</h2>
    <p>Indianapolis International Airport (IND) is about 10 miles southwest of downtown.</p>
    <div class="table-wrap">
    <table class="transport-table">
      <thead><tr><th>Option</th><th>Cost</th><th>Time</th><th>Notes</th></tr></thead>
      <tbody>
        <tr>
          <td><strong>IndyGo Bus Route 8</strong></td>
          <td data-label="Cost">$2.75</td>
          <td data-label="Time">45‚Äì60 min</td>
          <td data-label="Notes">Most budget-friendly; runs every 30 min. Pay with the <a href="https://www.indygo.net/mykey/" target="_blank" rel="noopener">myKey app</a>. Pickup on the ground floor past rental car counters.</td>
        </tr>
        <tr>
          <td><strong>Uber / Lyft</strong></td>
          <td data-label="Cost">$25‚Äì40</td>
          <td data-label="Time">20‚Äì30 min</td>
          <td data-label="Notes">Most convenient; varies by demand. <a href="https://docs.google.com/forms/d/e/1FAIpQLSei6P9I3dupDDF6Fni6G4n7oHx5vRWVAOpikKDLEkQ2fMPDcg/viewform" target="_blank" rel="noopener">Find a rideshare buddy via IRE's form</a>. Same ground-floor pickup area.</td>
        </tr>
        <tr>
          <td><strong>Taxi</strong></td>
          <td data-label="Cost">$45‚Äì55</td>
          <td data-label="Time">20‚Äì30 min</td>
          <td data-label="Notes">Taxi stand on the ground floor at the end of the standard pickup/dropoff area.</td>
        </tr>
      </tbody>
    </table>
    </div>

    <h2>Getting Around Downtown</h2>
    <p>The JW Marriott sits on the western edge of downtown, connected directly to the Convention Center. Food and drink options are within a 10-min walk, but you'll want to venture further for more variety.</p>

    <h3>Skywalk</h3>
    <p>A skywalk system connects the JW Marriott, the Convention Center, and several nearby hotels ‚Äî handy in bad weather. Note: there's ongoing construction, especially past the Convention Center. Fingers crossed for good weather.</p>

    <h3>Public Transit</h3>
    <p>Bus fare is $2.75 (two-hour pass, capped at $6/day). Pay with the <a href="https://www.indygo.net/mykey/" target="_blank" rel="noopener">myKey app</a>. Google Maps works great for trip planning. Not the most convenient option from the conference location, but it works.</p>

    <h3>Bike Share & Scooters</h3>
    <p><a href="https://pacersbikeshare.org/" target="_blank" rel="noopener">Pacers Bikeshare</a> has a station right across the street from the hotel ‚Äî use the BCycle app. E-bikes are available for more but well worth it. Electric scooters (Bird and Lime) are also available throughout downtown.</p>

    <h3>Rideshare</h3>
    <p>Uber and Lyft are widely available. Typical downtown rides run $8‚Äì15. If you're traveling with a few people, rideshare is almost always better value than the bus.</p>

    <h2>Practical Info</h2>

    <h3>Weather</h3>
    <p>March in Indiana is unpredictable ‚Äî you might get winter and summer in the same weekend. Expect daytime temps in the 35‚Äì55¬∞F range, with nights dipping into the 20s or 30s. Bring a raincoat or umbrella; snow is possible. Layer up for both outdoors and conference rooms.</p>

    <h3>Shopping & Supplies</h3>
    <p>Nearest pharmacy is CVS; nearest grocery stores are Kroger and Whole Foods.</p>
  </div>
</div>

<div class="page-empty" id="page-things-to-do" role="tabpanel" aria-labelledby="tab-things-to-do">
  <div class="content-page">
    <h2>Places to Wander</h2>
    <ul>
      <li><strong>Fountain Square</strong> <span class="note">Vibrant, historic cultural district with an eclectic vibe ‚Äî restaurants, vintage shops, and bars.</span></li>
      <li><strong>Fletcher Place</strong> <span class="note">Fountain Square's "older sister." Highly walkable with stunning Gothic Revival and Queen Anne architecture.</span></li>
      <li><strong>Mass Ave</strong> <span class="note">Perfect for an afternoon stroll through shops or an evening bar crawl. A little something for everyone.</span></li>
      <li><strong>Bottleworks District</strong> <span class="note">A fusion of industrial history and modern life ‚Äî food hall (The Garage), upscale restaurants, bowling, niche shops, and the historic Bottleworks Hotel.</span></li>
      <li><strong>Irvington</strong> <span class="note">Historic east-side neighborhood named after Washington Irving ‚Äî unique restaurants and charming craftsman and colonial homes.</span></li>
    </ul>

    <h2>Shows</h2>
    <div class="table-wrap">
    <table class="transport-table">
      <thead><tr><th>Event</th><th>Type</th><th>Venue</th><th>Date</th><th>Cost</th></tr></thead>
      <tbody>
        <tr><td><strong>Blithe Spirit</strong></td><td data-label="Type">Comedy</td><td data-label="Venue">Scottish Rite ¬∑ Downtown</td><td data-label="Date">Mar 5</td><td data-label="Cost">$24</td></tr>
        <tr><td><strong>Curtis Cook</strong></td><td data-label="Type">Comedy</td><td data-label="Venue">Helium Comedy Club ¬∑ Downtown</td><td data-label="Date">Mar 5</td><td data-label="Cost">$16</td></tr>
        <tr><td><strong>Arkansauce</strong></td><td data-label="Type">Bluegrass</td><td data-label="Venue">Turn Table ¬∑ Broad Ripple (20-min drive)</td><td data-label="Date">Mar 5</td><td data-label="Cost">$22</td></tr>
        <tr><td><strong>Indianapolis Symphony & Ballet: The Sleeping Beauty</strong></td><td data-label="Type">Dance</td><td data-label="Venue">Butler University ¬∑ Broad Ripple (20-min drive)</td><td data-label="Date">Mar 6</td><td data-label="Cost">$24</td></tr>
        <tr><td><strong>The Floozies + Too Many Zooz</strong></td><td data-label="Type">Brass house</td><td data-label="Venue">Old National Centre ¬∑ Downtown</td><td data-label="Date">Mar 6</td><td data-label="Cost">$36</td></tr>
        <tr><td><strong>Foxy Shazam</strong></td><td data-label="Type">Rock</td><td data-label="Venue">Turn Table ¬∑ Broad Ripple (20-min drive)</td><td data-label="Date">Mar 7</td><td data-label="Cost">$39</td></tr>
        <tr><td><strong>Chatterbox Jazz Club</strong>*</td><td data-label="Type">Jazz</td><td data-label="Venue">Downtown</td><td data-label="Date">Every night (no Sundays)</td><td data-label="Cost">‚Äî</td></tr>
      </tbody>
    </table>
    </div>
    <p class="table-note">* Cozy, gritty institution. Don't bring too big a crowd.</p>

    <h2>Sporting Events</h2>
    <div class="table-wrap">
    <table class="transport-table">
      <thead><tr><th>Event</th><th>Venue</th><th>Dates</th><th>Cost</th></tr></thead>
      <tbody>
        <tr>
          <td><strong>Big 10 Women's Basketball Tournament</strong></td>
          <td data-label="Venue">Gainbridge Fieldhouse ¬∑ Downtown</td>
          <td data-label="Dates">Mar 5‚Äì8</td>
          <td data-label="Cost">Approx. $20 or more</td>
        </tr>
        <tr>
          <td><strong>2026 U.S. Open: Bowling</strong></td>
          <td data-label="Venue">96th Street ¬∑ 35-min drive</td>
          <td data-label="Dates">Mar 8</td>
          <td data-label="Cost">$45</td>
        </tr>
      </tbody>
    </table>
    </div>
    <p class="table-note">Three Big 10 teams are currently in the top 10 nationally. All-tourney passes are available now; single-game tickets coming soon.</p>

    <h2>Parks & Exercise</h2>
    <p><strong>White River State Park</strong> and the <strong>Indianapolis Canal Walk</strong> are both right by the hotel ‚Äî great for a morning run or stroll. Head west over the river for nice views of downtown. Pickleball and basketball courts are available in area parks.</p>
    <p>If you want a proper workout, options nearby include the <strong>Irsay Family YMCA at CityWay</strong>, <strong>Invoke Yoga & Pilates Studio</strong>, and <strong>NIFS</strong> (all downtown), plus <strong>North Mass Boulder</strong> on the East Side (15-min drive).</p>

    <h2>History & Museums</h2>
    <ul class="activity-list">
      <li>
        <div class="activity-main"><strong>University Park & Veterans Memorial Plaza</strong> <span class="meta">Downtown</span></div>
      </li>
      <li>
        <div class="activity-main"><strong>Indiana State Museum</strong> <span class="meta">Downtown</span> <span class="cost-badge">$22</span></div>
      </li>
      <li>
        <div class="activity-main"><strong>Indiana Historical Society</strong> <span class="meta">Downtown</span> <span class="cost-badge">$15</span></div>
      </li>
      <li>
        <div class="activity-main"><strong>Kurt Vonnegut Museum & Library</strong> <span class="meta">Downtown ¬∑ Wed‚ÄìMon 10‚Äì6, Sun 12‚Äì5</span> <span class="cost-badge">$8‚Äì$12</span></div>
        <div class="activity-note">Vonnegut was born and raised in Indianapolis. Pick up the museum's literary journal, <em>So It Goes No. 14: The Year of the Journalist.</em></div>
      </li>
    </ul>

    <h2>Art</h2>
    <ul class="activity-list">
      <li>
        <div class="activity-main"><strong>Eiteljorg Museum of American Indians and Western Art</strong> <span class="meta">Downtown</span> <span class="cost-badge">$22</span></div>
      </li>
      <li>
        <div class="activity-main"><strong>Contemporary Art Museum (CAMi)</strong> <span class="meta">Downtown</span></div>
      </li>
      <li>
        <div class="activity-main"><strong>Indianapolis Museum of Art</strong> <span class="meta">North of Downtown ¬∑ 20-min drive</span> <span class="cost-badge">$25</span></div>
      </li>
      <li>
        <div class="activity-main"><strong>First Fridays</strong> <span class="meta">Various venues ¬∑ Downtown</span></div>
        <div class="activity-note">Free art events at spots around the city on the first Friday of each month.</div>
      </li>
    </ul>

    <h2>Activities & Events</h2>
    <div class="table-wrap">
    <table class="transport-table">
      <thead><tr><th>Activity</th><th>Where</th><th>Date</th><th>Cost</th></tr></thead>
      <tbody>
        <tr><td><strong>Maple Syrup Season</strong></td><td data-label="Where">Southeast Indy ¬∑ 25-min drive</td><td data-label="Date">Mar 5‚Äì8</td><td data-label="Cost">$6</td></tr>
        <tr><td><strong>Candle making</strong> at Penn & Beech</td><td data-label="Where">Downtown</td><td data-label="Date"></td><td data-label="Cost">$20+</td></tr>
        <tr><td><strong>Paint a pair of sneakers</strong> at Kicasso</td><td data-label="Where">Broad Ripple ¬∑ 20-min drive</td><td data-label="Date"></td><td data-label="Cost">$49+</td></tr>
        <tr><td><strong>Vintage video games & pinball</strong> at Tappers</td><td data-label="Where">Downtown</td><td data-label="Date"></td><td data-label="Cost">$15+</td></tr>
        <tr><td><strong>Drag Queen Sip & Paint</strong></td><td data-label="Where">Downtown</td><td data-label="Date">Mar 7</td><td data-label="Cost">$48</td></tr>
        <tr><td><strong>Cold Frames & Seed Starting</strong> <span style="font-size:0.8em;color:var(--text-muted)">Gardening class</span></td><td data-label="Where">Broad Ripple ¬∑ 20-min drive</td><td data-label="Date">Mar 7</td><td data-label="Cost">$20</td></tr>
        <tr><td><strong>Athenaeum Bier & Building Tour</strong></td><td data-label="Where">Downtown</td><td data-label="Date">Mar 8</td><td data-label="Cost">$43</td></tr>
        <tr>
          <td><strong>Indoor go-karting</strong></td>
          <td data-label="Where">Speedway ¬∑ 15-min drive</td>
          <td data-label="Date">Mar 8</td>
          <td data-label="Cost">‚Äî</td>
        </tr>
      </tbody>
    </table>
    </div>
    <p class="table-note">Speedway is the town within Indianapolis that hosts the largest single-day sporting event in the world. The Indianapolis Motor Speedway Museum is also worth a visit, even for non-racing fans.</p>

    <h2>Shopping</h2>
    <ul class="activity-list">
      <li><div class="activity-main"><strong>Tomorrow Book Store</strong> <span class="meta">Downtown</span></div></li>
      <li><div class="activity-main"><strong>Silver in the City</strong> <span class="meta">Downtown</span></div></li>
      <li><div class="activity-main"><strong>Artisans</strong> <span class="meta">Downtown & Broad Ripple</span></div></li>
      <li><div class="activity-main"><strong>Midland Arts & Antiques</strong> <span class="meta">Downtown</span></div></li>
      <li><div class="activity-main"><strong>The Botanical Bar</strong> <span class="meta">East Side ¬∑ 15-min drive</span></div></li>
      <li>
        <div class="activity-main"><strong>Dear Mom</strong> <span class="meta">East Side ¬∑ 15-min drive</span></div>
        <div class="activity-note">Eclectic shop for zines, books, snacks, and vintage clothing. Rabble coffee shop next door.</div>
      </li>
      <li>
        <div class="activity-main"><strong>Loudmouth Books</strong> <span class="meta">Near North Side ¬∑ 10-min drive</span></div>
        <div class="activity-note">Promoters of banned books. There's also a sweet stationery store nearby.</div>
      </li>
    </ul>
  </div>
</div>

<script>
window.addEventListener('load', function() {
const restaurants = [
  // === BREAKFAST/BRUNCH ===
  {name:"Lincoln Square Pancake House",address:"150 W. Market St.",lat:39.769,lng:-86.1614,cuisine:"American",price:"$",priceNum:1,distance:"10-min walk",distanceNum:10,meals:["Breakfast/Brunch"],hours:"Open until 3pm",notes:"Cheap breakfast, big portions. Not quite a diner but a diner in spirit.",dietary:false,groups:false},
  {name:"Caf√© Patachou",address:"225 W. Washington St.",lat:39.7669,lng:-86.16190,cuisine:"American",price:"$",priceNum:1,distance:"<10-min walk",distanceNum:8,meals:["Breakfast/Brunch","Lunch"],hours:"Open until 3pm",notes:"Indy brunch/lunch staple. ~$15 entr√©es, self-serve coffee bar. Also at 1060 N. Capitol Ave. Gets busy quickly.",dietary:true,groups:false},
  {name:"Garden Table",address:"342 Massachusetts Ave.",lat:39.7721,lng:-86.1533,cuisine:"American",price:"$$",priceNum:2,distance:"6-min drive",distanceNum:6,meals:["Breakfast/Brunch"],hours:"Open until 3pm",notes:"Quintessential fru-fru brunch. Freshly squeezed juices, acai bowls. Great service.",dietary:true,groups:false},
  {name:"Love Handle",address:"877 Massachusetts Ave.",lat:39.7792,lng:-86.1425,cuisine:"American",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Breakfast/Brunch"],hours:"Open until 3pm ¬∑ Closed Tue‚ÄìWed",notes:"Cool, weird spot with big sandwiches. Menu changes all the time. Fun throwback vibe.",dietary:false,groups:false},
  {name:"Milktooth",address:"534 Virginia Ave.",lat:39.7592,lng:-86.1465,cuisine:"American",price:"$$",priceNum:2,distance:"6-min drive",distanceNum:6,meals:["Breakfast/Brunch"],hours:"Open until 3pm ¬∑ Closed Tue‚ÄìThu",notes:"Very acclaimed brunch. Dutch baby pancakes, beignets, wings. Gets busy fast.",dietary:false,groups:false},
  // === LUNCH ===
  {name:"Subito",address:"34 N. Delaware St.",lat:39.768,lng:-86.1546,cuisine:"Soups/Sandwiches",price:"$",priceNum:1,distance:"6-min drive",distanceNum:6,meals:["Lunch"],hours:"Open until 3pm ¬∑ Weekdays only",notes:"Lovely soup and sandwich spot. The Revelo is a wonderful sandwich. $10‚Äì$15 lunch.",dietary:false,groups:false},
  {name:"Julieta",address:"1060 N. Capitol Ave.",lat:39.7813,lng:-86.1619,cuisine:"Mexican",price:"$",priceNum:1,distance:"7-min drive",distanceNum:7,meals:["Lunch"],hours:"Closed Mon, Sun",notes:"Walk-up taco counter with some of the best food in Indy. $5 tacos. Order through window at Turner's Bar next door for groups.",dietary:false,groups:true},
  {name:"Workingman's Friend",address:"234 N. Belmont Ave.",lat:39.7695,lng:-86.197,cuisine:"Burgers",price:"$",priceNum:1,distance:"7-min drive",distanceNum:7,meals:["Lunch"],hours:"Open until 2:45pm ¬∑ Closed Mon, Sun",notes:"Legendary smashburgers. Cash only w/ ATM inside. Will be packed.",dietary:false,groups:false},
  {name:"Yolis Supermarket",address:"4202 S. Meridian St.",lat:39.705,lng:-86.15890,cuisine:"Mexican",price:"$",priceNum:1,distance:"11-min drive",distanceNum:11,meals:["Lunch"],hours:"Closed Sat",notes:"Taqueria inside a Mexican grocery store. Tons of taco and torta options.",dietary:false,groups:false},
  {name:"Bluebeard",address:"653 Virginia Ave.",lat:39.7576,lng:-86.146,cuisine:"New American",price:"$$",priceNum:2,distance:"6-min drive",distanceNum:6,meals:["Lunch","Dinner"],hours:"Lunch + dinner; Sun dinner only",notes:"2026 restaurant of the year. Great lunch value, amazing pastas and meat dishes at dinner.",dietary:true,groups:false},
  {name:"Daisy Bar",address:"1011 Massachusetts Ave.",lat:39.7813,lng:-86.1382,cuisine:"Fusion",price:"$$",priceNum:2,distance:"11-min drive",distanceNum:11,meals:["Breakfast/Brunch","Lunch","Dinner"],hours:"Sun closes 4pm",notes:"Fun caf√© by day, small plates by night. Daytime offerings are stronger. Nice coffee program.",dietary:true,groups:false},
  {name:"Shapiro's",address:"808 S. Meridian St.",lat:39.7563,lng:-86.1596,cuisine:"Deli",price:"$$",priceNum:2,distance:"4-min drive",distanceNum:4,meals:["Lunch"],hours:"",notes:"Jewish deli since the Taft administration. Immaculate Reuben. Kosher. Big tables for groups.",dietary:false,groups:true},
  {name:"Yazsh",address:"1705 E. Michigan St.",lat:39.7742,lng:-86.13030,cuisine:"Bulgarian",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Lunch","Dinner"],hours:"Closed Mon, Tue",notes:"Quaint Balkan and Mediterranean caf√©. Excellent salads. Good coffee. Dinner closer to $25/plate.",dietary:false,groups:false},
  // === DINNER ===
  {name:"Axum",address:"825 N. Pennsylvania St.",lat:39.7787,lng:-86.1556,cuisine:"Ethiopian",price:"$$",priceNum:2,distance:"8-min drive",distanceNum:8,meals:["Dinner"],hours:"Closed Mon",notes:"Solid injera with stewed meats, lentils and veggies. ~$20/plate, extremely filling.",dietary:false,groups:false},
  {name:"Bosphorus",address:"935 S. East St.",lat:39.7546,lng:-86.1493,cuisine:"Turkish",price:"$$",priceNum:2,distance:"7-min drive",distanceNum:7,meals:["Dinner"],hours:"Sun opens 4pm",notes:"Cozy Turkish spot. Massive portions. Surprising veg/vegan options. Staggering pita budget.",dietary:true,groups:false},
  {name:"Fat Dan's Deli",address:"410 E. Michigan St.",lat:39.7741,lng:-86.1497,cuisine:"American",price:"$‚Äì$$",priceNum:2,distance:"9-min drive",distanceNum:9,meals:["Dinner"],hours:"",notes:"Giant portions on paper, no plates. Italian beef, Chicago dogs, burgers. Fun atmosphere, good beer.",dietary:false,groups:false},
  {name:"Thaitanium",address:"735 Massachusetts Ave.",lat:39.7769,lng:-86.146,cuisine:"Thai",price:"$$",priceNum:2,distance:"9-min drive",distanceNum:9,meals:["Dinner"],hours:"",notes:"Passable Thai food, lots of options, amazing iced coffee cocktail. Accommodating to large groups ‚Äî call ahead.",dietary:false,groups:true},
  {name:"Lil Dumplings / The Garage",address:"926 Carrollton Ave.",lat:39.7804,lng:-86.1439,cuisine:"Japanese/Pan-Asian",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Dinner"],hours:"",notes:"Ramen/dandan spot in The Garage food hall. Run by former celebrated chef. Ideal for big groups ‚Äî multiple restaurants in one spot.",dietary:false,groups:true},
  {name:"Fernando's",address:"888 Massachusetts Ave.",lat:39.7796,lng:-86.1425,cuisine:"Brazilian/Mexican",price:"$$‚Äì$$$",priceNum:3,distance:"10-min drive",distanceNum:10,meals:["Dinner"],hours:"",notes:"Well-made Latin food. Try the chicken stroganoff or feijoada. Great for apps and drinks.",dietary:false,groups:false},
  {name:"St. Elmo",address:"127 S. Illinois St.",lat:39.7648,lng:-86.1598,cuisine:"Steakhouse",price:"$$$$",priceNum:4,distance:"12-min walk",distanceNum:12,meals:["Dinner"],hours:"Dinner only (opens 4pm)",notes:"THE Indianapolis restaurant. Shrimp cocktail + steak = excellent dinner. Budget blower.",dietary:false,groups:false},
  {name:"Tinker Street",address:"402 E. 16th St.",lat:39.7886,lng:-86.1507,cuisine:"New American",price:"$$$",priceNum:3,distance:"12-min drive",distanceNum:12,meals:["Dinner"],hours:"Dinner only (opens 5pm)",notes:"Author's personal favorite for a fancy dinner. More interesting than St. Elmo.",dietary:false,groups:false},
  // === LATE NIGHT ===
  {name:"Petra",address:"610 Massachusetts Ave.",lat:39.7758,lng:-86.14820,cuisine:"Greek",price:"$",priceNum:1,distance:"9-min drive",distanceNum:9,meals:["Late Night"],hours:"Fri‚ÄìSat open until 4am",notes:"Late night option past midnight. Not great food, but it's food. Try the spicy gyro.",dietary:false,groups:false},
  {name:"District Tap",address:"141 S. Meridian St.",lat:39.7645,lng:-86.1580,cuisine:"Pub",price:"$$",priceNum:2,distance:"14-min walk",distanceNum:14,meals:["Late Night"],hours:"",notes:"Standard pub fare, large drink selection. Within walking distance. Open until 1am Fri/Sat.",dietary:false,groups:false},
  {name:"The Dugout",address:"621 Virginia Ave.",lat:39.7582,lng:-86.1464,cuisine:"Pub",price:"$",priceNum:1,distance:"8-min drive",distanceNum:8,meals:["Late Night"],hours:"Sun closes 11:30pm",notes:"Big sports bar with decent food. Huge chicken tender portions. Solid chili dogs. Open until 1am.",dietary:false,groups:false},
  {name:"Pearl Street",address:"65 E. Pearl St.",lat:39.7662,lng:-86.1568,cuisine:"Pizza/Pub",price:"$$",priceNum:2,distance:"15-min walk",distanceNum:15,meals:["Late Night"],hours:"",notes:"Star reporter favorite. Eclectic pizzas, baked sandwiches. Kitchen til midnight Fri/Sat, bar til 3am.",dietary:false,groups:false},
  {name:"Slippery Noodle Inn",address:"372 S. Meridian St.",lat:39.7616,lng:-86.1585,cuisine:"Pub",price:"$$",priceNum:2,distance:"17-min walk",distanceNum:17,meals:["Late Night"],hours:"Sun opens 4pm",notes:"Indy's longest-running bar. Nice slice of history and not terrible food. Open until 2am Fri/Sat.",dietary:false,groups:false},
  // === WORTH A DRIVE ===
  {name:"Borage",address:"1609 N. Lynhurst Dr.",lat:39.7877,lng:-86.2504,cuisine:"American",price:"$$",priceNum:2,distance:"15-min drive",distanceNum:15,meals:["Breakfast/Brunch"],hours:"Open until 2pm ¬∑ Closed Mon",notes:"Caf√©/bakery. Lovely breakfast platter, fun sandwiches. Extremely dietary-friendly. Worth the drive.",dietary:true,groups:false},
  {name:"Asian Snack",address:"3605 Commercial Drive",lat:39.8182,lng:-86.2270,cuisine:"Chinese/Pan-Asian",price:"$",priceNum:1,distance:"15-min drive",distanceNum:15,meals:["Lunch"],hours:"Closed Tue",notes:"Inside an international grocery. Pork buns, chive pies, firecracker chicken. Can't go wrong.",dietary:false,groups:false},
  {name:"Macizo",address:"6335 Intech Commons Drive",lat:39.8799,lng:-86.2721,cuisine:"Mexican/Peruvian",price:"$$",priceNum:2,distance:"20-min drive",distanceNum:20,meals:["Lunch","Dinner"],hours:"Closed Sun",notes:"Maybe Indy's most charming restaurant. Husband-and-wife from MX and Peru. Try the mole enchiladas.",dietary:false,groups:false},
  {name:"Yaso Jamaican Grill",address:"1501 Prospect St.",lat:39.7520,lng:-86.1335,cuisine:"Jamaican",price:"$$",priceNum:2,distance:"11-min drive",distanceNum:11,meals:["Lunch","Dinner"],hours:"Closed Mon, Tue",notes:"Excellent stewed meats, goat curry, jerk chicken. Has a drive-thru. Beloved by locals.",dietary:false,groups:false},
  {name:"Ardys Concession",address:"4141 S. East St.",lat:39.7056,lng:-86.1484,cuisine:"Filipino",price:"$$",priceNum:2,distance:"13-min drive",distanceNum:13,meals:["Lunch","Dinner"],hours:"Thu‚ÄìSun only",notes:"Inside Philippine Cultural Center. Sisig and dinuguan are outstanding. Filipino BBQ kebabs famous from Indy 500.",dietary:false,groups:false},
  {name:"Tlaolli",address:"2830 E. Washington St.",lat:39.7686,lng:-86.1154,cuisine:"Mexican",price:"$",priceNum:1,distance:"15-min drive",distanceNum:15,meals:["Lunch","Dinner"],hours:"Thu‚ÄìSat only",notes:"Uber-charming Mexican spot. Tons of vegetarian and vegan options. Street corn, vegan tamales and enchiladas especially fantastic.",dietary:true,groups:false},
  // === COFFEE ===
  {name:"Georgia Street Grind",address:"25 W. Georgia St.",lat:39.7641,lng:-86.1588,cuisine:"Coffee",price:"$",priceNum:1,distance:"14-min walk",distanceNum:14,meals:["Coffee"],hours:"Sat‚ÄìSun closes noon",notes:"Best black coffee downtown. Used to convention rushes. Spanish lattes. Grab-and-go.",dietary:false,groups:true},
  {name:"Illumine Coffee",address:"11 S. Meridian St.",lat:39.7667,lng:-86.1579,cuisine:"Coffee",price:"$",priceNum:1,distance:"13-min walk",distanceNum:13,meals:["Coffee"],hours:"Closed Sun",notes:"Fast and friendly with creative lattes. Try the blackberry brown sugar latte. Grab-and-go.",dietary:false,groups:false},
  {name:"Tinker on Market",address:"380 E. Market St.",lat:39.7685,lng:-86.1510,cuisine:"Coffee",price:"$",priceNum:1,distance:"8-min drive",distanceNum:8,meals:["Coffee"],hours:"",notes:"Indy's biggest name in coffee. High-quality stuff. Limited seating ‚Äî not great for big groups.",dietary:false,groups:false},
  {name:"Cosmic Cardinal Caf√©",address:"101 W. Ohio St.",lat:39.7697,lng:-86.1602,cuisine:"Coffee",price:"$",priceNum:1,distance:"14-min walk",distanceNum:14,meals:["Coffee"],hours:"Weekdays only",notes:"In Lake City Bank building. Coffee and decent sandwiches. Can handle crowds.",dietary:false,groups:true},
  {name:"Monumental Coffee",address:"19 W. Ohio St.",lat:39.7698,lng:-86.1584,cuisine:"Coffee",price:"$",priceNum:1,distance:"17-min walk",distanceNum:17,meals:["Coffee"],hours:"Open until 2pm",notes:"Inside Sheraton City Centre hotel. Industrial feel.",dietary:false,groups:false},
  {name:"Starbucks",address:"10 S. West St.",lat:39.7665,lng:-86.1676,cuisine:"Coffee",price:"$",priceNum:1,distance:"In JW Marriott",distanceNum:1,meals:["Coffee"],hours:"",notes:"In JW Marriott. Also at 1 S. Capitol Ave. (Hyatt, 10-min walk) and 30 S. Meridian St. (13-min walk).",dietary:false,groups:false},
  {name:"Calvin Fletcher's",address:"647 Virginia Ave.",lat:39.7577,lng:-86.1460,cuisine:"Coffee",price:"$",priceNum:1,distance:"8-min drive",distanceNum:8,meals:["Coffee"],hours:"Closed Sun",notes:"Groovy Fletcher Place coffee shop. Best move for espresso snobs alongside Tinker and Georgia Street.",dietary:false,groups:false},
  {name:"Parlor Public House",address:"600 E. Ohio St.",lat:39.7701,lng:-86.1471,cuisine:"Coffee/Cocktails",price:"$$",priceNum:2,distance:"8-min drive",distanceNum:8,meals:["Coffee"],hours:"Thu‚ÄìSat cocktails til midnight",notes:"Swanky coffee-to-cocktails spot. Cozy tables and couches. Good for 2‚Äì4 people.",dietary:false,groups:false},
  // === BARS ===
  {name:"Ball and Biscuit",address:"331 Massachusetts Ave.",lat:39.7717,lng:-86.1534,cuisine:"Cocktail Bar",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Bars"],hours:"",notes:"High-end cocktails, tremendous vibe. Good but overpriced snacks. Til 2am Fri/Sat. Not ideal for big groups.",dietary:false,groups:false},
  {name:"Ralston's Drafthouse",address:"635 Massachusetts Ave.",lat:39.7758,lng:-86.1475,cuisine:"Sports Bar",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Bars"],hours:"",notes:"Solid bar fare, lots of TVs for games. Great fries, tenderloin, soft pretzels. Beer's a bit pricey.",dietary:false,groups:false},
  {name:"Liberty Street",address:"653 Massachusetts Ave.",lat:39.7761,lng:-86.1471,cuisine:"Bar",price:"$",priceNum:1,distance:"10-min drive",distanceNum:10,meals:["Bars"],hours:"Closed Mon, Tue",notes:"Never busy except Sat 10pm karaoke. Beautiful $4 Coors Banquet. Perfect bar.",dietary:false,groups:false},
  {name:"Almost Famous",address:"721 Massachusetts Ave.",lat:39.7766,lng:-86.1463,cuisine:"Tapas/Cocktails",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Bars"],hours:"Closed Mon",notes:"Tapas, high-end cocktails. Good for groups of 2‚Äì6. Fun bathroom decor. Til 2am Sat.",dietary:false,groups:false},
  {name:"Metro / Tini",address:"707‚Äì717 Massachusetts Ave.",lat:39.7766,lng:-86.1466,cuisine:"Nightclub",price:"$$",priceNum:2,distance:"10-min drive",distanceNum:10,meals:["Bars"],hours:"",notes:"Best options for dancing. May have cover charge. Bring earplugs. Til 3am Fri/Sat.",dietary:false,groups:false}
];

// Color by price
function priceColor(priceNum) {
  if (priceNum <= 1) return '#2271b2';
  if (priceNum <= 2) return '#009e73';
  if (priceNum <= 3) return '#994f88';
  return '#d55e00';
}

function priceClass(priceNum) {
  if (priceNum <= 1) return 'price-1';
  if (priceNum <= 2) return 'price-2';
  if (priceNum <= 3) return 'price-3';
  return 'price-4';
}

// Initialize map
const map = L.map('map', {
  zoomControl: true
}).setView([39.7663, -86.1684], 14);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/">CARTO</a>',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(map);

// JW Marriott marker
const jwMarker = L.marker([39.7663, -86.1684], {
  icon: L.divIcon({
    className: '',
    html: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="filter:drop-shadow(0 2px 4px rgba(0,0,0,0.35));"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26" fill="#b8792e" stroke="#fff" stroke-width="1.5" stroke-linejoin="round"/></svg>`,
    iconSize: [28, 28],
    iconAnchor: [14, 14]
  })
}).addTo(map).bindPopup('<div class="popup-name">JW Marriott</div><div class="popup-desc">Conference hotel ‚Äî your home base</div>', { autoPan: true });

// Create markers
const markers = {};
restaurants.forEach((r, i) => {
  const color = priceColor(r.priceNum);
  const icon = L.divIcon({
    className: '',
    html: `<div class="custom-marker" id="marker-${i}" style="background:${color}"></div>`,
    iconSize: [24, 24],
    iconAnchor: [12, 12]
  });

  const marker = L.marker([r.lat, r.lng], { icon }).addTo(map);
  marker.bindPopup(`
    <div class="popup-name">${r.name}</div>
    <div class="popup-cuisine">${r.cuisine}</div>
    <div class="popup-price" style="color:${priceColor(r.priceNum)}">${r.price}</div>
    ${r.hours ? '<div class="popup-hours">' + r.hours + '</div>' : ''}
    <div class="popup-desc">${r.notes}${r.dietary ? '<br><span style="color:#009e73;font-size:0.72rem;">‚úì Dietary-friendly</span>' : ''}${r.groups ? '<br><span style="color:#b8792e;font-size:0.72rem;">‚úì Good for groups</span>' : ''}</div>
    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(r.name + ', ' + r.address + ', Indianapolis, Indiana')}" target="_blank" rel="noopener" onclick="window.open(this.href,'_blank','noopener');return false;" style="display:inline-block;margin-top:6px;font-size:0.78rem;color:var(--accent);text-decoration:none;font-family:'IBM Plex Sans',sans-serif;">‚Üó Directions</a>
  `, { autoPan: true, autoPanPadding: [40, 40], maxWidth: 240 });
  markers[i] = marker;
});

// Populate cuisine filter
const cuisines = [...new Set(restaurants.map(r => r.cuisine))].sort();
const cuisineSelect = document.getElementById('filter-cuisine');
cuisines.forEach(c => {
  const opt = document.createElement('option');
  opt.value = c;
  opt.textContent = c;
  cuisineSelect.appendChild(opt);
});

// Sort state
let sortCol = 'name';
let sortAsc = true;

// Render table
function renderTable() {
  const priceFilter = parseFloat(document.getElementById('filter-price').value) || 999;
  const distFilter = parseInt(document.getElementById('filter-distance').value) || 999;
  const cuisineFilter = document.getElementById('filter-cuisine').value;
  const mealFilter = document.getElementById('filter-meal').value;
  const dietaryFilter = document.getElementById('filter-dietary').value;
  const searchFilter = document.getElementById('filter-search').value.toLowerCase();

  let filtered = restaurants.map((r, i) => ({ ...r, idx: i })).filter(r => {
    if (r.priceNum > priceFilter) return false;
    if (r.distanceNum > distFilter) return false;
    if (cuisineFilter && r.cuisine !== cuisineFilter) return false;
    if (mealFilter && !r.meals.includes(mealFilter)) return false;
    if (dietaryFilter === 'dietary' && !r.dietary) return false;
    if (dietaryFilter === 'groups' && !r.groups) return false;
    if (searchFilter && !r.name.toLowerCase().includes(searchFilter) && !r.notes.toLowerCase().includes(searchFilter) && !r.cuisine.toLowerCase().includes(searchFilter) && !r.address.toLowerCase().includes(searchFilter)) return false;
    return true;
  });

  // Sort
  filtered.sort((a, b) => {
    let va, vb;
    switch (sortCol) {
      case 'name': va = a.name; vb = b.name; break;
      case 'cuisine': va = a.cuisine; vb = b.cuisine; break;
      case 'price': va = a.priceNum; vb = b.priceNum; break;
      case 'distance': va = a.distanceNum; vb = b.distanceNum; break;
      case 'meal': va = a.meals[0]; vb = b.meals[0]; break;
      default: va = a.name; vb = b.name;
    }
    if (typeof va === 'string') {
      return sortAsc ? va.localeCompare(vb) : vb.localeCompare(va);
    }
    return sortAsc ? va - vb : vb - va;
  });

  // Update visible markers
  const visibleIdxs = new Set(filtered.map(r => r.idx));
  restaurants.forEach((r, i) => {
    if (visibleIdxs.has(i)) {
      markers[i].addTo(map);
    } else {
      map.removeLayer(markers[i]);
    }
  });

  // Render rows
  const tbody = document.getElementById('table-body');
  tbody.innerHTML = filtered.map(r => `
    <tr onclick="focusRestaurant(${r.idx})" data-idx="${r.idx}" tabindex="0" role="button" aria-label="${r.name}">
      <td class="name-cell">
        ${r.name}
        <div class="address">${r.address}</div>
        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(r.name + ', ' + r.address + ', Indianapolis, Indiana')}" target="_blank" rel="noopener" class="directions-link" onclick="event.stopPropagation();window.open(this.href,'_blank','noopener');return false;">‚Üó Directions</a>
      </td>
      <td class="cuisine-cell">${r.cuisine}</td>
      <td class="${priceClass(r.priceNum)} price-cell">${r.price}</td>
      <td class="distance-cell">${r.distance}</td>
      <td class="type-cell">${r.meals.join(', ')}</td>
      <td class="hours-cell">${r.hours}</td>
      <td class="notes-cell">
        ${r.notes}
        ${r.dietary ? '<div class="diet-badge">Veg/Vegan/GF</div>' : ''}
        ${r.groups ? '<div class="group-badge">Groups OK</div>' : ''}
      </td>
    </tr>
  `).join('');

  // Render mobile cards (separate container)
  const mobileCards = document.getElementById('mobile-cards');
  mobileCards.innerHTML = filtered.map(r => `
    <div class="mobile-card" onclick="focusRestaurant(${r.idx})" data-card-idx="${r.idx}">
      <div class="mobile-card-header">
        <div class="mobile-card-name">${r.name}</div>
        <div class="mobile-card-price ${priceClass(r.priceNum)}">${r.price}</div>
      </div>
      <div class="mobile-card-address">${r.address} ¬∑ <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(r.name + ', ' + r.address + ', Indianapolis, Indiana')}" target="_blank" rel="noopener" class="directions-link" onclick="event.stopPropagation();window.open(this.href,'_blank','noopener');return false;">‚Üó Directions</a></div>
      <div class="mobile-card-meta">
        <span class="cuisine-tag">${r.cuisine}</span>
        <span class="mobile-card-distance">${r.distance}</span>
        <span class="mobile-card-meal">¬∑ ${r.meals.join(', ')}</span>
      </div>
      <div class="mobile-card-notes">
        ${r.hours ? '<span class="hours-note">' + r.hours + '</span> ' : ''}
        ${r.notes}
        ${r.dietary ? '<div class="diet-badge">Veg/Vegan/GF friendly</div>' : ''}
        ${r.groups ? '<div class="group-badge">Good for groups</div>' : ''}
      </div>
    </div>
  `).join('');

  document.getElementById('result-count').textContent = `${filtered.length} of ${restaurants.length}`;

  // Update header sort indicators
  document.querySelectorAll('th[data-sort]').forEach(th => {
    th.classList.toggle('sorted', th.dataset.sort === sortCol);
    const arrow = th.querySelector('.sort-arrow');
    if (th.dataset.sort === sortCol) {
      arrow.textContent = sortAsc ? '‚Üë' : '‚Üì';
    } else {
      arrow.textContent = '‚Üï';
    }
  });
}

function focusRestaurant(idx) {
  const r = restaurants[idx];
  map.closePopup();

  // Check if we're already at this location
  const currentCenter = map.getCenter();
  const alreadyThere = Math.abs(currentCenter.lat - r.lat) < 0.0001 && Math.abs(currentCenter.lng - r.lng) < 0.0001 && map.getZoom() === 16;

  if (alreadyThere) {
    markers[idx].openPopup();
  } else {
    map.setView([r.lat, r.lng], 16, { animate: true });
    map.once('moveend', () => {
      markers[idx].openPopup();
    });
    // Fallback in case moveend doesn't fire
    setTimeout(() => {
      if (!markers[idx].isPopupOpen()) markers[idx].openPopup();
    }, 600);
  }

  document.querySelectorAll('tr.highlighted').forEach(el => el.classList.remove('highlighted'));
  document.querySelectorAll('.mobile-card.highlighted').forEach(el => el.classList.remove('highlighted'));
  document.querySelectorAll('.custom-marker.highlighted').forEach(el => el.classList.remove('highlighted'));
  const markerEl = document.getElementById('marker-' + idx);
  if (markerEl) markerEl.classList.add('highlighted');
  const row = document.querySelector(`tr[data-idx="${idx}"]`);
  if (row) row.classList.add('highlighted');
  const card = document.querySelector(`.mobile-card[data-card-idx="${idx}"]`);
  if (card) card.classList.add('highlighted');
  if (window.innerWidth <= 900) {
    setTimeout(() => {
      document.querySelector('.map-panel').scrollIntoView({ behavior: 'smooth' });
    }, 700);
  }
}
window.focusRestaurant = focusRestaurant;

function resetFilters() {
  document.getElementById('filter-price').value = '';
  document.getElementById('filter-distance').value = '';
  document.getElementById('filter-cuisine').value = '';
  document.getElementById('filter-meal').value = '';
  document.getElementById('filter-dietary').value = '';
  document.getElementById('filter-search').value = '';
  renderTable();
}
window.resetFilters = resetFilters;

// Sort handlers
document.querySelectorAll('th[data-sort]').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.dataset.sort;
    if (sortCol === col) {
      sortAsc = !sortAsc;
    } else {
      sortCol = col;
      sortAsc = true;
    }
    renderTable();
  });
});

// Filter handlers
['filter-price', 'filter-distance', 'filter-cuisine', 'filter-meal', 'filter-dietary'].forEach(id => {
  document.getElementById(id).addEventListener('change', renderTable);
});
document.getElementById('filter-search').addEventListener('input', (function() {
  let timer;
  return function() {
    clearTimeout(timer);
    timer = setTimeout(renderTable, 200);
  };
})());

// Keyboard navigation for table rows
document.getElementById('table-body').addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    const row = e.target.closest('tr[data-idx]');
    if (row) focusRestaurant(parseInt(row.dataset.idx));
  }
});

// Reset map view
document.getElementById('reset-map-btn').addEventListener('click', () => {
  document.querySelectorAll('tr.highlighted').forEach(el => el.classList.remove('highlighted'));
  document.querySelectorAll('.mobile-card.highlighted').forEach(el => el.classList.remove('highlighted'));
  document.querySelectorAll('.custom-marker.highlighted').forEach(el => el.classList.remove('highlighted'));
  map.closePopup();
  map.setView([39.7663, -86.1684], 14, { animate: true });
});

// Mobile legend toggle
document.querySelector('.legend').addEventListener('click', function() {
  if (window.innerWidth <= 900) {
    this.classList.toggle('expanded');
  }
});

// Geolocation
let userMarker = null;
const locateBtn = document.getElementById('locate-btn');

locateBtn.addEventListener('click', () => {
  if (!navigator.geolocation) {
    alert('Geolocation is not supported by your browser.');
    return;
  }

  locateBtn.classList.add('loading');
  locateBtn.classList.remove('active');

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const { latitude, longitude } = pos.coords;
      locateBtn.classList.remove('loading');
      locateBtn.classList.add('active');

      if (userMarker) {
        userMarker.setLatLng([latitude, longitude]);
      } else {
        userMarker = L.marker([latitude, longitude], {
          icon: L.divIcon({
            className: '',
            html: '<div class="user-location-dot"></div>',
            iconSize: [16, 16],
            iconAnchor: [8, 8]
          }),
          zIndexOffset: 1000
        }).addTo(map).bindPopup('<div class="popup-name">You are here</div>', { autoPan: false });
      }

      map.setView([latitude, longitude], 14, { animate: true });
      userMarker.openPopup();
    },
    (err) => {
      locateBtn.classList.remove('loading');
      if (err.code === 1) {
        alert('Location access denied. Please enable location permissions.');
      } else {
        alert('Unable to determine your location.');
      }
    },
    { enableHighAccuracy: true, timeout: 10000 }
  );
});

// Tab navigation
document.querySelectorAll('.nav a').forEach(link => {
  link.addEventListener('click', (e) => {
    e.preventDefault();
    const page = link.dataset.page;
    document.querySelectorAll('.nav a').forEach(a => {
      a.classList.remove('active');
      a.setAttribute('aria-selected', 'false');
    });
    link.classList.add('active');
    link.setAttribute('aria-selected', 'true');
    document.querySelectorAll('.page, .page-empty').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    if (page === 'food') {
      document.body.classList.remove('content-mode');
      setTimeout(() => map.invalidateSize(), 150);
    } else {
      document.body.classList.add('content-mode');
      window.scrollTo(0, 0);
    }
  });
});

// Initial render
renderTable();
}); // end window.addEventListener('load')
</script>

</body>
</html>
